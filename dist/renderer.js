(()=>{var e={409:e=>{"use strict";e.exports=require("./drm.js")},933:e=>{"use strict";e.exports=require("electron")}},t={};function o(n){var s=t[n];if(void 0!==s)return s.exports;var i=t[n]={exports:{}};return e[n](i,i.exports,o),i.exports}(()=>{const{ipcMain:e}=o(933),t=o(933),n=t.ipcRenderer,s=(t.app,document.getElementsByTagName("body")[0],document.getElementById("output-dir-config")),i=document.getElementById("output-dir-value"),r=document.getElementById("main-log-entry"),d=document.getElementById("main-log-text"),c=(document.getElementById("main-log-sub"),document.getElementById("run-progress")),u=document.getElementById("run-button");i.innerHTML=n.sendSync("get-output-dir");const l=(e,t)=>{e.removeEventListener("click",t),e.classList.remove("clickable")},a=(e,t)=>{e.addEventListener("click",t),e.classList.add("clickable")},p=(e,t)=>{const o=(e=>{let t=e.childNodes;for(const e of t)if("#text"===e.nodeName)return e})(e);o&&(o.nodeValue=t)},m=(e,t)=>{const o=(e=>{let t=e.childNodes;for(const e of t)if("DIV"===e.nodeName)return e})(e);t=t.length>=60?t.slice(0,60).concat("..."):t,o&&(o.innerHTML=t)},k=async e=>{e.preventDefault(),n.send("select-output-dir")};let y;n.on("selected-output-dir",((e,t)=>{(e=>{i.innerHTML=e})(t)})),a(s,k);class g{constructor(e,t){this.usersCount=e,this.booksCount=t,this.processedBooksCount=0,this.processedUsersCount=0,this.percent="0".concat("%")}addOneBook(){this.processedBooksCount+=1}addOneUser(){this.processedUsersCount+=1}getPercent(){return 0!==this.booksCount&&(this.percent=Math.floor(this.processedBooksCount/this.booksCount*100).toFixed(0).concat("%")),this.percent}}const f=function(e){n.send("show-output-dir")},{drmEmitter:b}=o(409),h=b.drmEvents;n.on(h.taskStart,(function(e,t,o){p(d,"Started"),m(d,"Loading local library..."),y=new g(t,o)})),n.on(h.onNewUser,(function(e,t,o){p(d,t),y.addOneUser(),r.style.display="flex"})),n.on(h.onNewBook,(function(e,t){y.addOneBook(),c.innerHTML=y.getPercent(),m(d,t)})),n.on(h.taskDone,(function(e,t){if(c.style.visibility="hidden",y.processedBooksCount>0){p(d,"All done! Click to check your output directory.");let e=`Processed ${y.usersCount} users, ${y.booksCount} books.`;m(d,e),a(r,f)}else p(d,"Oops! Seems like you didn't download any books."),m(d,"Please download some books in Ridibooks app and try again.");u.innerHTML="ReRUN",a(u,v),a(s,k)})),n.on(h.beforeTaskDone,(function(e){p(d,"Pending"),m(d,"Preparing book files...")})),n.on(h.noData,(function(){c.style.visibility="hidden",p(d,"Oops! Can't find any local data."),m(d,"Please download some books in Ridibooks app and try again."),u.innerHTML="ReRUN",a(u,v),a(s,k)}));const v=e=>{l(u,v),l(s,k),l(r,f),d.classList.remove("init"),c.innerHTML="0%",c.style.visibility="visible",process.nextTick(n.send,"run"),n.send("log","[IM IN RENDERER]")};a(u,v)})(),module.exports={}})();